<?xml version="1.0"?>
<launch>
  <!-- Launch file for rostest-based testing of autonomy-arduino integration -->
  
  <!-- Arguments -->
  <arg name="port" default="/dev/ttyACM0" />
  <arg name="baud" default="57600" />
  <arg name="mock_arduino" default="true" doc="Set to false if testing with real Arduino" />
  
  <!-- Optional: Start rosserial node if mock_arduino is false -->
  <node unless="$(arg mock_arduino)" name="arduino_serial" pkg="rosserial_python" type="serial_node.py" output="screen">
    <param name="port" value="$(arg port)" />
    <param name="baud" value="$(arg baud)" />
  </node>
  
  <!-- Start a mock Arduino for testing if mock_arduino is true -->
  <node if="$(arg mock_arduino)" name="mock_arduino" pkg="rostopic" type="rostopic" 
        args="echo /hydrus/thrusters/1 /hydrus/thrusters/2 /hydrus/thrusters/3 /hydrus/thrusters/4 /hydrus/thrusters/5 /hydrus/thrusters/6 /hydrus/thrusters/7 /hydrus/thrusters/8" 
        output="screen" />
  
  <!-- Start the submarine controller -->
  <node name="submarine_controller" pkg="autonomy" type="controllers.py" output="screen" />
  
  <!-- Launch the test -->
  <test test-name="test_autonomy_arduino_integration" pkg="hydrus" type="test_autonomy_arduino_integration.py" />
</launch>